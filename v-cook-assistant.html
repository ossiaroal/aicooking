<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-Cook 厨房AI助手</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        .container {
            width: 90%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .main-content {
            padding: 30px;
        }
        
        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .function-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .function-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .function-card.recipe {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }
        
        .function-card.timer {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }
        
        .function-card.safety {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
        }
        
        .function-card.voice {
            background: linear-gradient(135deg, #a8caba 0%, #5d4e75 100%);
            color: white;
        }
        
        .function-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }
        
        .function-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .function-desc {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .voice-control {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .voice-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 15px;
            display: block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .voice-button:hover {
            transform: scale(1.1);
        }
        
        .voice-button.listening {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            animation: pulse 1s infinite;
        }
        
        .voice-status {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .voice-text {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            min-height: 50px;
            border: 2px dashed #ddd;
            font-style: italic;
            color: #666;
        }
        
        .response-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .timer-display {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .timer-time {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .recipe-search {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        .recipe-results {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .recipe-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .recipe-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        /* 主界面语音控制样式 */
        .main-voice-control {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
        }
        
        .main-voice-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 15px;
            display: block;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .main-voice-button:hover {
            transform: scale(1.1);
        }
        
        .main-voice-button.listening {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            animation: pulse 1s infinite;
        }
        
        .main-voice-status {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .main-voice-text {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            min-height: 50px;
            border: 2px dashed #ddd;
            font-style: italic;
            color: #666;
        }
        
        /* 新页面通用样式 */
        .recipe-page, .timer-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 20px;
            font-size: 1.1em;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* 菜谱页面样式 */
        .recipe-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .category-icon {
            font-size: 3em;
            display: block;
            margin-bottom: 15px;
        }
        
        .category-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .recipe-search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .ai-search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
        }
        
        .search-btn {
            padding: 15px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            white-space: nowrap;
        }
        
        .recipe-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .recipe-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .recipe-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .recipe-image {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        
        .recipe-info {
            flex: 1;
        }
        
        .recipe-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .recipe-desc {
            color: #666;
            font-size: 0.9em;
        }
        
        /* 定时器页面样式 */
        .timer-display-large {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .timer-time-large {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .timer-status {
            font-size: 1.2em;
            color: #666;
        }
        
        .quick-timer-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 20px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .quick-btn:hover {
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .timer-slider-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .timer-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin: 20px 0;
        }
        
        .timer-slider::-webkit-slider-thumb {
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .timer-voice-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .timer-voice-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        
        .timer-voice-text {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            color: #666;
            font-style: italic;
        }
        
        .timer-controls-section {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .timer-controls-section .btn {
            padding: 15px 30px;
            font-size: 1.1em;
        }
        
        .hidden {
            display: none !important;
        }
        
        .ai-config-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            display: none;
            border: 2px solid #667eea;
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .ai-status.connected {
            background: #d4edda;
            color: #155724;
        }
        
        .ai-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .config-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .config-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        
        /* 横置平板电脑适配 */
        @media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
            /* 整体布局适配 */
            .container {
                max-width: 95%;
                display: flex;
                flex-direction: row;
                height: 90vh;
                overflow: hidden;
            }
            
            .header {
                width: 30%;
                border-radius: 20px 0 0 20px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                padding: 20px;
            }
            
            .main-content {
                width: 70%;
                max-height: 90vh;
                overflow-y: auto;
                padding: 20px;
                border-radius: 0 20px 20px 0;
            }
            
            .function-grid {
                grid-template-columns: repeat(2, 1fr);
                margin-bottom: 20px;
            }
            
            .response-area {
                max-height: 30vh;
            }
            
            /* AI配置面板适配 */
            .ai-config-panel {
                padding: 20px;
            }
            
            #aiConfigForm {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            
            #aiConfigForm > div {
                width: 100%;
                display: flex;
                justify-content: flex-start;
                gap: 10px;
            }
            
            .config-group {
                width: 48%;
                margin-bottom: 15px;
            }
            
            .config-buttons {
                display: flex;
                justify-content: flex-start;
                gap: 10px;
                margin-top: 15px;
                width: 100%;
            }
            
            /* 其他功能区域适配 */
            .voice-control, .recipe-search, .safety-tips, .timer-display {
                margin: 15px 0;
                padding: 15px;
            }
            
            .voice-button {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
            
            .recipe-results {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="avatar">👨‍🍳</div>
            <h1>V-Cook</h1>
            <p>您的贴心厨房AI助手</p>
        </div>
        
        <div class="main-content">
            <!-- 功能卡片 -->
            <div class="function-grid">
                <div class="function-card recipe" onclick="openRecipePage()">
                    <span class="function-icon">📖</span>
                    <div class="function-title">菜谱查询</div>
                    <div class="function-desc">搜索美味菜谱</div>
                </div>
                
                <div class="function-card timer" onclick="openTimerPage()">
                    <span class="function-icon">⏰</span>
                    <div class="function-title">厨房定时</div>
                    <div class="function-desc">设置烹饪计时</div>
                </div>
            </div>
            
            <!-- 主界面语音按钮 -->
            <div class="main-voice-control">
                <button class="main-voice-button" id="mainVoiceBtn" onclick="toggleMainVoice()">
                    🎤
                </button>
                <div class="main-voice-status" id="mainVoiceStatus">点击语音助手</div>
                <div class="main-voice-text" id="mainVoiceText">通过语音设定定时和查询菜谱</div>
            </div>
            
            <!-- AI配置面板 -->
            <div class="ai-config-panel" id="aiConfigPanel">
                <h3>🤖 AI助手配置</h3>
                <div class="ai-status" id="aiStatus">
                    <span>AI状态：未配置</span>
                    <button class="btn btn-secondary" onclick="toggleAIConfig()">配置</button>
                </div>
                
                <div id="aiConfigForm" style="display: none;">
                    <div class="config-group">
                        <label class="config-label">API提供商：</label>
                        <select class="config-input" id="aiProvider">
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="claude">Anthropic (Claude)</option>
                            <option value="gemini">Google (Gemini)</option>
                            <option value="local">本地模型</option>
                        </select>
                    </div>
                    
                    <div class="config-group">
                        <label class="config-label">API密钥：</label>
                        <input type="password" class="config-input" id="aiApiKey" placeholder="输入您的API密钥">
                    </div>
                    
                    <div class="config-group">
                        <label class="config-label">API地址：</label>
                        <input type="text" class="config-input" id="aiBaseUrl" placeholder="API基础URL">
                    </div>
                    
                    <div class="config-group">
                        <label class="config-label">模型名称：</label>
                        <input type="text" class="config-input" id="aiModel" placeholder="模型名称">
                    </div>
                    
                    <div class="config-buttons">
                        <button class="btn btn-primary" onclick="saveAIConfig()">保存配置</button>
                        <button class="btn btn-secondary" onclick="testAIConnection()">测试连接</button>
                        <button class="btn btn-secondary" onclick="clearAIConfig()">清除配置</button>
                    </div>
                </div>
            </div>
            
            <!-- 响应区域 -->
            <div class="response-area" id="responseArea">
                <div>👋 您好！我是V-Cook，您的贴心厨房助手。<br>您可以通过语音查询菜谱或设置定时器。</div>
            </div>
        </div>
    </div>
    
    <!-- 菜谱页面 -->
    <div class="recipe-page" id="recipePage" style="display: none;">
        <div class="page-header">
            <button class="back-btn" onclick="backToMain()">← 返回</button>
            <h2>菜谱大全</h2>
        </div>
        
        <div class="recipe-categories">
            <div class="category-card" onclick="showCategoryRecipes('meat')">
                <span class="category-icon">🥩</span>
                <div class="category-title">荤菜</div>
            </div>
            <div class="category-card" onclick="showCategoryRecipes('vegetable')">
                <span class="category-icon">🥬</span>
                <div class="category-title">素菜</div>
            </div>
            <div class="category-card" onclick="showCategoryRecipes('cold')">
                <span class="category-icon">🥗</span>
                <div class="category-title">凉菜</div>
            </div>
            <div class="category-card" onclick="showCategoryRecipes('soup')">
                <span class="category-icon">🍲</span>
                <div class="category-title">汤</div>
            </div>
        </div>
        
        <div class="recipe-search-section">
            <input type="text" class="ai-search-input" placeholder="输入菜名，AI为您生成菜谱..." id="aiRecipeInput">
            <button class="search-btn" onclick="generateAIRecipe()">🤖 AI生成菜谱</button>
        </div>
        
        <div class="recipe-list" id="recipeList"></div>
        <div class="recipe-detail" id="recipeDetail" style="display: none;"></div>
    </div>
    
    <!-- 定时器页面 -->
    <div class="timer-page" id="timerPage" style="display: none;">
        <div class="page-header">
            <button class="back-btn" onclick="backToMain()">← 返回</button>
            <h2>厨房定时器</h2>
        </div>
        
        <div class="timer-display-large">
            <div class="timer-time-large" id="timerTimeLarge">00:00</div>
            <div class="timer-status" id="timerStatus">准备就绪</div>
        </div>
        
        <div class="quick-timer-buttons">
            <button class="quick-btn" onclick="setQuickTimer(1)">1分钟</button>
            <button class="quick-btn" onclick="setQuickTimer(3)">3分钟</button>
            <button class="quick-btn" onclick="setQuickTimer(5)">5分钟</button>
            <button class="quick-btn" onclick="setQuickTimer(15)">15分钟</button>
            <button class="quick-btn" onclick="setQuickTimer(20)">20分钟</button>
        </div>
        
        <div class="timer-slider-section">
            <label>自定义时间：<span id="sliderValue">10</span> 分钟</label>
            <input type="range" class="timer-slider" id="timerSlider" min="1" max="100" value="10" oninput="updateSliderValue()">
            <button class="btn btn-primary" onclick="setCustomTimer()">设置定时</button>
        </div>
        
        <div class="timer-voice-section">
            <button class="timer-voice-btn" id="timerVoiceBtn" onclick="toggleTimerVoice()">
                🎤 语音设定时间
            </button>
            <div class="timer-voice-text" id="timerVoiceText">说出您需要的时间，如"5分钟"</div>
        </div>
        
        <div class="timer-controls-section">
            <button class="btn btn-primary" id="startPauseBtn" onclick="toggleTimer()">开始</button>
            <button class="btn btn-secondary" onclick="resetTimer()">重置</button>
        </div>
        </div>
    </div>
    
    <script>
        class VCookAssistant {
            constructor() {
                this.isListening = false;
                this.mainVoiceListening = false;
                this.timerVoiceListening = false;
                this.recognition = null;
                this.timerInterval = null;
                this.timerSeconds = 0;
                this.timerRunning = false;
                this.currentPage = 'main'; // 'main', 'recipe', 'timer'
                
                // AI模型配置
                this.aiConfig = {
                    // 可以配置不同的AI服务
                    provider: 'openai', // 'openai', 'claude', 'gemini', 'local'
                    apiKey: '', // 需要用户配置
                    baseUrl: 'https://api.openai.com/v1', // API基础URL
                    model: 'gpt-3.5-turbo' // 使用的模型
                };
                
                // 从本地存储加载AI配置
                const savedConfig = localStorage.getItem('vcook-ai-config');
                if (savedConfig) {
                    try {
                        this.aiConfig = JSON.parse(savedConfig);
                    } catch (e) {
                        console.error('加载AI配置失败:', e);
                    }
                }
                
                // 初始化语音识别
                this.initSpeechRecognition();
            }
            
            // 初始化语音识别
            initSpeechRecognition() {
                if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.lang = 'zh-CN';
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript.trim();
                        console.log('语音识别结果:', transcript);
                        
                        if (this.mainVoiceListening) {
                            document.getElementById('mainVoiceText').textContent = transcript;
                            this.processMainVoiceCommand(transcript);
                        } else if (this.timerVoiceListening) {
                            document.getElementById('timerVoiceText').textContent = transcript;
                            this.processTimerVoiceCommand(transcript);
                        }
                    };
                    
                    this.recognition.onend = () => {
                        if (this.mainVoiceListening) {
                            document.getElementById('mainVoiceBtn').classList.remove('listening');
                            document.getElementById('mainVoiceStatus').textContent = '点击语音助手';
                            this.mainVoiceListening = false;
                        } else if (this.timerVoiceListening) {
                            document.getElementById('timerVoiceBtn').classList.remove('listening');
                            document.getElementById('timerVoiceText').textContent = '说出您需要的时间，如"5分钟"';
                            this.timerVoiceListening = false;
                        }
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('语音识别错误:', event.error);
                        if (this.mainVoiceListening) {
                            document.getElementById('mainVoiceStatus').textContent = '识别失败，请重试';
                        } else if (this.timerVoiceListening) {
                            document.getElementById('timerVoiceText').textContent = '识别失败，请重试';
                        }
                    };
                } else {
                    console.error('浏览器不支持语音识别');
                }
            }
            
            // 主界面语音按钮
            toggleMainVoice() {
                if (!this.recognition) {
                    alert('您的浏览器不支持语音识别功能');
                    return;
                }
                
                if (this.mainVoiceListening) {
                    this.recognition.stop();
                    this.mainVoiceListening = false;
                    document.getElementById('mainVoiceBtn').classList.remove('listening');
                    document.getElementById('mainVoiceStatus').textContent = '点击语音助手';
                } else {
                    // 停止其他语音识别
                    if (this.timerVoiceListening) {
                        this.recognition.stop();
                        this.timerVoiceListening = false;
                        document.getElementById('timerVoiceBtn').classList.remove('listening');
                    }
                    
                    this.mainVoiceListening = true;
                    document.getElementById('mainVoiceBtn').classList.add('listening');
                    document.getElementById('mainVoiceStatus').textContent = '正在聆听...';
                    document.getElementById('mainVoiceText').textContent = '请说出您的指令';
                    
                    try {
                        this.recognition.start();
                    } catch (e) {
                        console.error('启动语音识别失败:', e);
                    }
                }
            }
            
            // 定时器页面语音按钮
            toggleTimerVoice() {
                if (!this.recognition) {
                    alert('您的浏览器不支持语音识别功能');
                    return;
                }
                
                if (this.timerVoiceListening) {
                    this.recognition.stop();
                    this.timerVoiceListening = false;
                    document.getElementById('timerVoiceBtn').classList.remove('listening');
                    document.getElementById('timerVoiceText').textContent = '说出您需要的时间，如"5分钟"';
                } else {
                    // 停止其他语音识别
                    if (this.mainVoiceListening) {
                        this.recognition.stop();
                        this.mainVoiceListening = false;
                        document.getElementById('mainVoiceBtn').classList.remove('listening');
                    }
                    
                    this.timerVoiceListening = true;
                    document.getElementById('timerVoiceBtn').classList.add('listening');
                    document.getElementById('timerVoiceText').textContent = '正在聆听...';
                    
                    try {
                        this.recognition.start();
                    } catch (e) {
                        console.error('启动语音识别失败:', e);
                    }
                }
            }
            
            // 处理主界面语音命令
            async processMainVoiceCommand(command) {
                if (!command) return;
                
                // 显示用户的语音输入
                this.updateResponse(`🎤 您说: ${command}`);
                
                // 处理简单命令
                if (command.includes('菜谱') || command.includes('食谱')) {
                    this.openRecipePage();
                    return;
                } else if (command.includes('定时') || command.includes('计时')) {
                    this.openTimerPage();
                    return;
                }
                
                // 使用AI处理复杂命令
                if (this.aiConfig.apiKey) {
                    try {
                        this.updateResponse('🤖 正在处理您的请求...');
                        const aiResponse = await this.callAI(command);
                        this.executeAIResponse(command, aiResponse);
                    } catch (error) {
                        console.error('AI处理失败:', error);
                        this.updateResponse(`❌ 抱歉，处理您的请求时出错: ${error.message}`);
                    }
                } else {
                    this.updateResponse('⚠️ 请先配置AI接口以启用高级语音功能');
                }
            }
            
            // 处理定时器页面语音命令
            processTimerVoiceCommand(command) {
                if (!command) return;
                
                // 尝试提取时间
                const timeMatch = command.match(/(\d+)\s*(分钟|秒钟|秒|分|小时|钟头)/i);
                if (timeMatch) {
                    const amount = parseInt(timeMatch[1]);
                    const unit = timeMatch[2];
                    
                    let seconds = 0;
                    if (unit.includes('小时') || unit.includes('钟头')) {
                        seconds = amount * 3600;
                    } else if (unit.includes('分')) {
                        seconds = amount * 60;
                    } else if (unit.includes('秒')) {
                        seconds = amount;
                    }
                    
                    if (seconds > 0) {
                        // 更新滑块值
                        const minutes = Math.max(1, Math.min(100, Math.round(seconds / 60)));
                        document.getElementById('timerSlider').value = minutes;
                        document.getElementById('sliderValue').textContent = minutes;
                        
                        // 启动定时器
                        this.startTimer(seconds);
                        document.getElementById('timerVoiceText').textContent = `已设置${minutes}分钟定时器`;
                        document.getElementById('timerStatus').textContent = '计时中...';
                        return;
                    }
                }
                
                document.getElementById('timerVoiceText').textContent = '未能识别时间，请重试';
            }
                
                // 菜谱数据
                this.recipeCategories = {
                    meat: [
                        { name: '红烧肉', desc: '经典家常菜，肥而不腻', icon: '🥩' },
                        { name: '宫保鸡丁', desc: '川菜经典，酸甜微辣', icon: '🍗' },
                        { name: '糖醋排骨', desc: '酸甜可口，色泽红亮', icon: '🍖' },
                        { name: '水煮肉片', desc: '川菜代表，麻辣鲜香', icon: '🥘' },
                        { name: '鱼香肉丝', desc: '咸甜酸辣，味道丰富', icon: '🥢' },
                        { name: '回锅肉', desc: '川菜经典，肥瘦相间', icon: '🐖' },
                        { name: '东坡肉', desc: '杭州名菜，肥而不腻', icon: '🍲' },
                        { name: '辣子鸡', desc: '干香麻辣，口感酥脆', icon: '🌶️' },
                        { name: '葱爆羊肉', desc: '鲜香可口，营养丰富', icon: '🐑' },
                        { name: '蒜蓉蒸虾', desc: '鲜香美味，简单易做', icon: '🦐' }
                    ],
                    vegetable: [
                        { name: '西红柿炒蛋', desc: '家常经典，酸甜可口', icon: '🍅' },
                        { name: '蒜蓉炒青菜', desc: '清淡爽口，营养健康', icon: '🥬' },
                        { name: '麻婆豆腐', desc: '川菜经典，麻辣鲜香', icon: '🧊' },
                        { name: '干煸四季豆', desc: '香脆可口，下饭神器', icon: '🥗' },
                        { name: '醋溜白菜', desc: '酸甜爽口，开胃下饭', icon: '🥬' },
                        { name: '蒜蓉茄子', desc: '软糯香浓，紫色诱惑', icon: '🍆' },
                        { name: '香菇青菜', desc: '鲜香清淡，营养丰富', icon: '🍄' },
                        { name: '素炒三丝', desc: '色彩缤纷，爽口开胃', icon: '🥕' },
                        { name: '葱油拌豆腐', desc: '清淡爽口，简单易做', icon: '🧊' },
                        { name: '蒜香花菜', desc: '脆嫩可口，营养丰富', icon: '🥦' }
                    ],
                    cold: [
                        { name: '凉拌黄瓜', desc: '清脆爽口，开胃消暑', icon: '🥒' },
                        { name: '凉拌木耳', desc: '爽滑可口，营养丰富', icon: '🥗' },
                        { name: '皮蛋豆腐', desc: '经典凉菜，口感丰富', icon: '🥚' },
                        { name: '凉拌海带丝', desc: '清爽可口，低脂健康', icon: '🥗' },
                        { name: '凉拌三丝', desc: '色彩缤纷，爽口开胃', icon: '🥕' },
                        { name: '酱牛肉', desc: '五香浓郁，口感醇厚', icon: '🐄' },
                        { name: '凉拌茄子', desc: '软糯香浓，开胃下饭', icon: '🍆' },
                        { name: '蒜泥白肉', desc: '川菜经典，肥而不腻', icon: '🐖' },
                        { name: '凉拌藕片', desc: '脆嫩爽口，营养丰富', icon: '🥗' },
                        { name: '醉虾', desc: '鲜香微醺，独特风味', icon: '🦐' }
                    ],
                    soup: [
                        { name: '番茄蛋花汤', desc: '酸甜可口，营养丰富', icon: '🍅' },
                        { name: '紫菜蛋花汤', desc: '鲜美清淡，简单易做', icon: '🥣' },
                        { name: '冬瓜排骨汤', desc: '清甜爽口，营养滋补', icon: '🍖' },
                        { name: '鸡蛋豆腐汤', desc: '鲜香嫩滑，老少皆宜', icon: '🥚' },
                        { name: '西红柿牛肉汤', desc: '酸甜鲜美，营养丰富', icon: '🐄' },
                        { name: '莲藕排骨汤', desc: '甜美滋补，营养丰富', icon: '🍲' },
                        { name: '鲫鱼豆腐汤', desc: '鲜美可口，营养丰富', icon: '🐟' },
                        { name: '玉米排骨汤', desc: '甜香可口，营养丰富', icon: '🌽' },
                        { name: '海带排骨汤', desc: '鲜美可口，营养丰富', icon: '🍲' },
                        { name: '萝卜牛腩汤', desc: '浓郁鲜香，营养丰富', icon: '🥕' }
                    ]
                };
                
                this.initSpeechRecognition();
                this.initSpeechSynthesis();
                this.initAIConfig();
            }
            
            initAIConfig() {
                // 从localStorage读取AI配置
                const savedConfig = localStorage.getItem('vcook-ai-config');
                if (savedConfig) {
                    this.aiConfig = { ...this.aiConfig, ...JSON.parse(savedConfig) };
                }
                
                // 如果没有API密钥，提示用户配置
                if (!this.aiConfig.apiKey) {
                    this.showAIConfigPrompt();
                }
            }
            
            showAIConfigPrompt() {
                const apiKey = prompt('请输入您的AI API密钥（OpenAI/Claude等）\n\n注意：密钥将保存在本地浏览器中，请确保设备安全。\n\n如果暂时不配置，将使用内置的基础功能。');
                if (apiKey && apiKey.trim()) {
                    this.aiConfig.apiKey = apiKey.trim();
                    localStorage.setItem('vcook-ai-config', JSON.stringify(this.aiConfig));
                    this.speak('AI功能已启用，现在可以为您提供更智能的菜谱推荐和语音理解服务！');
                }
            }
            
            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    this.recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    this.recognition.lang = 'zh-CN';
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    
                    this.recognition.onstart = () => {
                        // 根据当前模式设置不同的UI反馈
                        if (this.mainVoiceListening) {
                            document.getElementById('mainVoiceBtn').classList.add('listening');
                            document.getElementById('mainVoiceStatus').textContent = '正在聆听...';
                        } else if (this.timerVoiceListening) {
                            document.getElementById('timerVoiceBtn').classList.add('listening');
                            document.getElementById('timerVoiceText').textContent = '正在聆听...';
                        }
                    };
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        
                        // 根据当前模式处理语音命令
                        if (this.mainVoiceListening) {
                            document.getElementById('mainVoiceText').textContent = transcript;
                            this.processMainVoiceCommand(transcript);
                        } else if (this.timerVoiceListening) {
                            document.getElementById('timerVoiceText').textContent = transcript;
                            this.processTimerVoiceCommand(transcript);
                        }
                    };
                    
                    this.recognition.onend = () => {
                        // 根据当前模式重置UI状态
                        if (this.mainVoiceListening) {
                            this.mainVoiceListening = false;
                            document.getElementById('mainVoiceBtn').classList.remove('listening');
                            document.getElementById('mainVoiceStatus').textContent = '点击语音助手';
                        } else if (this.timerVoiceListening) {
                            this.timerVoiceListening = false;
                            document.getElementById('timerVoiceBtn').classList.remove('listening');
                            document.getElementById('timerVoiceText').textContent = '说出您需要的时间，如"5分钟"';
                        }
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('语音识别错误:', event.error);
                        this.speak('抱歉，我没有听清楚，请再说一遍');
                    };
                }
            }
            
            initSpeechSynthesis() {
                // 语音合成初始化
                if ('speechSynthesis' in window) {
                    // 等待语音列表加载
                    speechSynthesis.getVoices();
                }
            }
            
            toggleMainVoice() {
                if (this.mainVoiceListening) {
                    this.recognition.stop();
                } else {
                    if (this.recognition) {
                        this.mainVoiceListening = true;
                        this.timerVoiceListening = false;
                        this.recognition.start();
                    } else {
                        this.speak('抱歉，您的浏览器不支持语音识别功能');
                    }
                }
            }
            
            toggleTimerVoice() {
                if (this.timerVoiceListening) {
                    this.recognition.stop();
                } else {
                    if (this.recognition) {
                        this.timerVoiceListening = true;
                        this.mainVoiceListening = false;
                        this.recognition.start();
                    } else {
                        this.speak('抱歉，您的浏览器不支持语音识别功能');
                    }
                }
            }
            
            async processMainVoiceCommand(command) {
                const cmd = command.toLowerCase();
                
                // 如果配置了AI，使用AI进行智能理解
                if (this.aiConfig.apiKey) {
                    await this.handleAICommand(command);
                } else {
                    // 使用基础的关键词匹配
                    if (cmd.includes('菜谱') || cmd.includes('做菜') || cmd.includes('怎么做') || cmd.includes('食谱')) {
                        this.speak('正在为您打开菜谱页面');
                        setTimeout(() => openRecipePage(), 1000);
                    } else if (cmd.includes('定时') || cmd.includes('计时') || cmd.includes('提醒') || cmd.includes('时间')) {
                        this.speak('正在为您打开定时器');
                        setTimeout(() => openTimerPage(), 1000);
                    } else if (cmd.includes('你好') || cmd.includes('帮助')) {
                        this.handleGreeting();
                    } else {
                        this.speak('您可以通过语音查询菜谱或设置定时器');
                    }
                }
            }
            
            processTimerVoiceCommand(command) {
                const cmd = command.toLowerCase();
                let minutes = 0;
                
                // 提取时间数字
                const numberMatch = cmd.match(/(\d+)\s*分钟/);
                if (numberMatch && numberMatch[1]) {
                    minutes = parseInt(numberMatch[1]);
                    if (minutes > 0 && minutes <= 100) {
                        this.speak(`已设置${minutes}分钟的定时器`);
                        setQuickTimer(minutes);
                    } else if (minutes > 100) {
                        this.speak('定时器最长支持100分钟');
                    } else {
                        this.speak('请设置有效的时间');
                    }
                } else {
                    this.speak('请说出您需要的时间，例如"5分钟"');
                }
            }
            
            async handleAICommand(command) {
                try {
                    this.updateResponse('🤖 正在思考中...');
                    
                    const response = await this.callAI(command);
                    
                    // 检查是否包含菜谱或定时器相关指令
                    const cmd = command.toLowerCase();
                    if (cmd.includes('菜谱') || cmd.includes('做菜') || cmd.includes('怎么做') || cmd.includes('食谱')) {
                        this.speak('正在为您打开菜谱页面');
                        setTimeout(() => openRecipePage(), 1000);
                    } else if (cmd.includes('定时') || cmd.includes('计时') || cmd.includes('提醒') || cmd.includes('时间')) {
                        this.speak('正在为您打开定时器');
                        setTimeout(() => openTimerPage(), 1000);
                    }
                    this.updateResponse(response);
                    this.speak(response);
                    
                    // 根据AI响应执行相应操作
                    this.executeAIResponse(response, command);
                } catch (error) {
                    console.error('AI调用失败:', error);
                    this.updateResponse('抱歉，AI服务暂时不可用，为您切换到基础功能模式。');
                    this.speak('AI服务暂时不可用，为您切换到基础功能');
                    
                    // 降级到基础功能
                    const cmd = command.toLowerCase();
                    if (cmd.includes('菜谱') || cmd.includes('做菜') || cmd.includes('怎么做')) {
                        this.handleRecipeQuery(command);
                    } else if (cmd.includes('定时') || cmd.includes('计时') || cmd.includes('提醒')) {
                        this.handleTimerCommand(command);
                    } else {
                        this.handleGeneralQuery(command);
                    }
                }
            }
            
            async callAI(userMessage) {
                const systemPrompt = `你是V-Cook，一个贴心的厨房AI助手。你的职责是：
1. 提供详细的菜谱和烹饪指导
2. 帮助用户设置厨房定时器
3. 提供厨房安全建议
4. 回答烹饪相关问题

请用温和、专业的语调回答，保持简洁但有用。如果用户询问菜谱，请提供具体的食材和步骤。如果用户要设置定时器，请识别时间并确认。

当前用户说："${userMessage}"

请分析用户意图并给出合适的回应。如果是菜谱查询，请提供详细做法。如果是定时需求，请确认时间。`;
                
                const requestBody = {
                    model: this.aiConfig.model,
                    messages: [
                        {
                            role: 'system',
                            content: systemPrompt
                        },
                        {
                            role: 'user',
                            content: userMessage
                        }
                    ],
                    max_tokens: 500,
                    temperature: 0.7
                };
                
                const response = await fetch(`${this.aiConfig.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.aiConfig.apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content.trim();
            }
            
            executeAIResponse(response, originalCommand) {
                // 检查AI响应中是否包含定时器设置
                const timerMatch = response.match(/(\d+)分钟|(\d+)秒/);
                if (timerMatch && originalCommand.includes('定时')) {
                    let seconds = 0;
                    if (timerMatch[1]) {
                        seconds = parseInt(timerMatch[1]) * 60;
                    } else if (timerMatch[2]) {
                        seconds = parseInt(timerMatch[2]);
                    }
                    if (seconds > 0) {
                        this.startTimer(seconds);
                    }
                }
                
                // 检查是否是菜谱查询，显示菜谱搜索面板
                if (originalCommand.includes('菜谱') || originalCommand.includes('做菜') || originalCommand.includes('怎么做')) {
                    document.getElementById('recipeSearch').style.display = 'block';
                }
                
                // 检查是否是安全查询，显示安全提醒
                if (originalCommand.includes('安全') || response.includes('安全')) {
                    document.getElementById('safetyTips').style.display = 'block';
                }
            }
            
            handleRecipeQuery(command) {
                let response = '';
                
                if (command.includes('西红柿炒蛋')) {
                    response = '西红柿炒蛋的做法：先将鸡蛋打散炒熟盛起，再炒西红柿出汁，最后倒入鸡蛋翻炒即可。记得先放糖再放盐哦！';
                } else if (command.includes('红烧肉')) {
                    response = '红烧肉需要五花肉、冰糖、生抽、老抽。先焯水，再炒糖色，小火慢炖一小时。记得中途翻面，最后大火收汁。';
                } else {
                    response = '我为您推荐几道家常菜：西红柿炒蛋、红烧肉、宫保鸡丁。您想了解哪道菜的具体做法呢？';
                }
                
                this.updateResponse(response);
                this.speak(response);
                document.getElementById('recipeSearch').style.display = 'block';
            }
            
            handleTimerCommand(command) {
                const timeMatch = command.match(/(\d+)分钟?|(\d+)秒/);
                
                if (timeMatch) {
                    let seconds = 0;
                    if (timeMatch[1]) {
                        seconds = parseInt(timeMatch[1]) * 60;
                    } else if (timeMatch[2]) {
                        seconds = parseInt(timeMatch[2]);
                    }
                    
                    this.startTimer(seconds);
                    const response = `好的，我为您设置了${Math.floor(seconds/60)}分钟${seconds%60}秒的定时器`;
                    this.updateResponse(response);
                    this.speak(response);
                } else {
                    const response = '请告诉我需要定时多长时间，比如"定时5分钟"';
                    this.updateResponse(response);
                    this.speak(response);
                }
            }
            
            handleSafetyQuery() {
                const response = '厨房安全很重要！请注意用火安全、刀具使用、保持清洁卫生，还要注意电器安全。我已为您显示详细的安全提醒。';
                this.updateResponse(response);
                this.speak(response);
                document.getElementById('safetyTips').style.display = 'block';
            }
            
            handleGreeting() {
                const responses = [
                    '您好！我是V-Cook，很高兴为您服务。今天想做什么美食呢？',
                    '欢迎使用V-Cook厨房助手！我可以帮您查菜谱、设定时器、提醒安全事项。',
                    '您好！作为您的厨房伙伴，我随时准备为您提供烹饪帮助。'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                this.updateResponse(response);
                this.speak(response);
            }
            
            handleGeneralQuery(command) {
                const response = '我是您的厨房助手V-Cook。您可以问我菜谱做法、设置定时器，或者了解厨房安全知识。还有什么我可以帮您的吗？';
                this.updateResponse(response);
                this.speak(response);
            }
            
            updateResponse(text) {
                document.getElementById('responseArea').innerHTML = `<div>🤖 ${text}</div>`;
            }
            
            speak(text) {
                if ('speechSynthesis' in window) {
                    // 停止当前播放
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-CN';
                    utterance.rate = 0.8;
                    utterance.pitch = 1.1;
                    utterance.volume = 0.9;
                    
                    // 选择合适的语音
                    const voices = speechSynthesis.getVoices();
                    const preferredVoices = voices.filter(voice => 
                        voice.lang.includes('zh') && 
                        (voice.name.includes('女') || voice.name.includes('Female'))
                    );
                    
                    if (preferredVoices.length > 0) {
                        utterance.voice = preferredVoices[0];
                    }
                    
                    speechSynthesis.speak(utterance);
                }
            }
            
            startTimer(seconds) {
                this.timerSeconds = seconds;
                this.timerRunning = true;
                
                // 清除之前的定时器
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                
                this.timerInterval = setInterval(() => {
                    if (this.timerRunning && this.timerSeconds > 0) {
                        this.timerSeconds--;
                        this.updateTimerDisplay();
                        
                        if (this.timerSeconds === 0) {
                            this.timerComplete();
                        }
                    }
                }, 1000);
                
                // 更新开始/暂停按钮文本
                document.getElementById('startPauseBtn').textContent = '暂停';
                document.getElementById('timerStatus').textContent = '计时中...';
                
                this.updateTimerDisplay();
            }
            
            updateTimerDisplay() {
                const minutes = Math.floor(this.timerSeconds / 60);
                const seconds = this.timerSeconds % 60;
                const timeText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // 更新定时器页面的时间显示
                if (this.currentPage === 'timer') {
                    document.getElementById('timerTimeLarge').textContent = timeText;
                }
            }
            
            timerComplete() {
                this.timerRunning = false;
                clearInterval(this.timerInterval);
                this.speak('时间到了！请注意查看您的菜品。');
                this.updateResponse('⏰ 定时器时间到了！请及时处理您的菜品。');
                
                // 更新状态和按钮
                document.getElementById('timerStatus').textContent = '时间到！';
                document.getElementById('startPauseBtn').textContent = '开始';
                
                // 闪烁提醒
                const timerDisplay = document.getElementById('timerTimeLarge');
                timerDisplay.style.animation = 'pulse 0.5s infinite';
                
                setTimeout(() => {
                    timerDisplay.style.animation = '';
                }, 5000);
            }
            
            pauseTimer() {
                this.timerRunning = !this.timerRunning;
                const btn = document.getElementById('startPauseBtn');
                btn.textContent = this.timerRunning ? '暂停' : '继续';
                document.getElementById('timerStatus').textContent = this.timerRunning ? '计时中...' : '已暂停';
            }
            
            resetTimer() {
                this.timerRunning = false;
                this.timerSeconds = 0;
                clearInterval(this.timerInterval);
                
                // 更新UI
                document.getElementById('timerTimeLarge').textContent = '00:00';
                document.getElementById('timerStatus').textContent = '准备就绪';
                document.getElementById('startPauseBtn').textContent = '开始';
            }
            
            // 更新响应区域
            updateResponse(text) {
                const responseArea = document.getElementById('responseArea');
                responseArea.innerHTML = `<div>${text}</div>`;
            }
            
            // 定时器页面功能
            setQuickTimer(minutes) {
                if (minutes > 0 && minutes <= 100) {
                    const seconds = minutes * 60;
                    this.startTimer(seconds);
                    document.getElementById('timer-slider').value = minutes;
                    document.getElementById('timer-value').textContent = `${minutes}分钟`;
                }
            }
            
            updateTimerSlider() {
                const minutes = parseInt(document.getElementById('timer-slider').value);
                document.getElementById('timer-value').textContent = `${minutes}分钟`;
            }
            
            startTimerFromSlider() {
                const minutes = parseInt(document.getElementById('timer-slider').value);
                if (minutes > 0) {
                    this.setQuickTimer(minutes);
                }
            }
            
            // 页面导航函数
            openRecipePage() {
                document.querySelector('.main-content').style.display = 'none';
                document.getElementById('recipePage').style.display = 'block';
                document.getElementById('timerPage').style.display = 'none';
                this.currentPage = 'recipe';
                this.loadRecipeCategories();
            }
            
            openTimerPage() {
                document.querySelector('.main-content').style.display = 'none';
                document.getElementById('recipePage').style.display = 'none';
                document.getElementById('timerPage').style.display = 'block';
                this.currentPage = 'timer';
                this.initTimerPage();
            }
            
            returnToMain() {
                document.querySelector('.main-content').style.display = 'block';
                document.getElementById('recipePage').style.display = 'none';
                document.getElementById('timerPage').style.display = 'none';
                this.currentPage = 'main';
            }
            
            // 加载菜谱分类
            loadRecipeCategories() {
                // 菜谱分类已经在HTML中定义，只需要添加点击事件
                // 初始化菜谱数据
                this.recipeCategories = {
                    meat: [
                        { name: '红烧肉', desc: '经典家常菜，肥而不腻', icon: '🥩' },
                        { name: '宫保鸡丁', desc: '川菜代表，香辣可口', icon: '🍗' },
                        { name: '糖醋排骨', desc: '酸甜开胃，老少皆宜', icon: '🍖' },
                        { name: '水煮肉片', desc: '麻辣鲜香，下饭神器', icon: '🥩' },
                        { name: '鱼香肉丝', desc: '川菜经典，咸甜微辣', icon: '🥓' },
                        { name: '回锅肉', desc: '川菜特色，肥瘦相间', icon: '🥩' },
                        { name: '东坡肉', desc: '传统名菜，软糯入味', icon: '🍖' },
                        { name: '辣子鸡', desc: '麻辣香脆，下酒佳品', icon: '🍗' },
                        { name: '葱爆羊肉', desc: '鲜香不膻，营养丰富', icon: '🍖' },
                        { name: '京酱肉丝', desc: '北方特色，甜咸适中', icon: '🥓' }
                    ],
                    vegetable: [
                        { name: '干煸四季豆', desc: '脆嫩入味，下饭佳品', icon: '🥬' },
                        { name: '蒜蓉炒菠菜', desc: '清淡爽口，营养丰富', icon: '🥗' },
                        { name: '醋溜白菜', desc: '酸甜爽脆，开胃消食', icon: '🥬' },
                        { name: '蒜香茄子', desc: '软糯入味，紫色诱人', icon: '🍆' },
                        { name: '清炒西兰花', desc: '脆嫩爽口，营养丰富', icon: '🥦' },
                        { name: '香菇青菜', desc: '鲜香可口，清淡爽口', icon: '🥬' },
                        { name: '素炒三丝', desc: '色彩丰富，爽口开胃', icon: '🥕' },
                        { name: '麻婆豆腐', desc: '麻辣鲜香，豆香浓郁', icon: '🧊' },
                        { name: '蚝油生菜', desc: '翠绿爽脆，鲜香可口', icon: '🥬' },
                        { name: '糖醋藕片', desc: '酸甜脆嫩，开胃爽口', icon: '🥗' }
                    ],
                    cold: [
                        { name: '凉拌黄瓜', desc: '清脆爽口，开胃消暑', icon: '🥒' },
                        { name: '皮蛋豆腐', desc: '经典凉菜，软嫩可口', icon: '🧊' },
                        { name: '凉拌木耳', desc: '爽滑脆嫩，营养丰富', icon: '🥗' },
                        { name: '凉拌海带丝', desc: '清爽可口，低卡健康', icon: '🥗' },
                        { name: '凉拌三丝', desc: '色彩丰富，口感多样', icon: '🥗' },
                        { name: '蒜泥白肉', desc: '五花三层，蒜香浓郁', icon: '🥓' },
                        { name: '凉拌茄子', desc: '紫色诱人，软糯爽口', icon: '🍆' },
                        { name: '凉拌豆腐皮', desc: '清淡爽口，营养丰富', icon: '🧊' },
                        { name: '酸辣土豆丝', desc: '酸辣开胃，脆嫩可口', icon: '🥔' },
                        { name: '醉鸡', desc: '酒香浓郁，嫩滑多汁', icon: '🍗' }
                    ],
                    soup: [
                        { name: '西红柿蛋汤', desc: '酸甜可口，营养丰富', icon: '🍅' },
                        { name: '紫菜蛋花汤', desc: '鲜美清淡，简单易做', icon: '🥣' },
                        { name: '冬瓜排骨汤', desc: '清甜爽口，滋补养生', icon: '🍖' },
                        { name: '鸡汤', desc: '鲜香浓郁，滋补养身', icon: '🍗' },
                        { name: '萝卜牛腩汤', desc: '浓郁鲜香，营养丰富', icon: '🥩' },
                        { name: '莲藕排骨汤', desc: '清甜爽口，滋补养生', icon: '🍖' },
                        { name: '玉米排骨汤', desc: '甜香可口，营养均衡', icon: '🌽' },
                        { name: '海带豆腐汤', desc: '清淡鲜美，低卡健康', icon: '🧊' },
                        { name: '番茄牛肉汤', desc: '酸甜可口，营养丰富', icon: '🍅' },
                        { name: '鱼头豆腐汤', desc: '鲜美无比，营养丰富', icon: '🐟' }
                    ]
                };
            }
            
            // 初始化定时器页面
            initTimerPage() {
                // 更新定时器显示
                document.getElementById('timerTimeLarge').textContent = '00:00';
                document.getElementById('timerStatus').textContent = '准备就绪';
                
                // 初始化滑块值
                document.getElementById('timerSlider').value = 10;
                document.getElementById('sliderValue').textContent = '10';
            }
            
            // 显示分类菜谱
            showCategoryRecipes(categoryId) {
                const recipeList = document.getElementById('recipeList');
                recipeList.innerHTML = '';
                document.getElementById('recipeDetail').style.display = 'none';
                
                const recipes = this.recipeCategories[categoryId] || [];
                
                recipes.forEach(recipe => {
                    const recipeItem = document.createElement('div');
                    recipeItem.className = 'recipe-item';
                    recipeItem.innerHTML = `
                        <div class="recipe-icon">${recipe.icon}</div>
                        <div class="recipe-info">
                            <div class="recipe-name">${recipe.name}</div>
                            <div class="recipe-desc">${recipe.desc}</div>
                        </div>
                    `;
                    recipeItem.addEventListener('click', () => this.showRecipeDetail(recipe.name));
                    recipeList.appendChild(recipeItem);
                });
            }
            
            // 显示菜谱详情
            async showRecipeDetail(recipeName) {
                const detailContainer = document.getElementById('recipeDetail');
                detailContainer.style.display = 'block';
                document.getElementById('recipeList').style.display = 'none';
                
                detailContainer.innerHTML = '<div class="loading">正在加载菜谱详情...</div>';
                
                try {
                    let recipeDetail;
                    if (this.aiConfig.apiKey) {
                        recipeDetail = await this.getRecipeDetailsWithAI(recipeName);
                    } else {
                        // 使用基础菜谱数据
                        const basicRecipes = {
                            '西红柿炒蛋': '【材料】\n鸡蛋3个、西红柿2个、葱花适量、盐适量、糖少许\n\n【步骤】\n1. 西红柿洗净切块，鸡蛋打散加少许盐\n2. 热锅冷油，倒入鸡蛋液炒熟盛出\n3. 锅中倒油，放入葱花爆香\n4. 放入西红柿块，翻炒出汁\n5. 加入少许糖提鲜\n6. 倒入炒好的鸡蛋，翻炒均匀\n7. 最后加盐调味即可',
                            '红烧肉': '【材料】\n五花肉500g、姜片、葱段、八角2个、冰糖30g、生抽、老抽、料酒\n\n【步骤】\n1. 五花肉切块，冷水下锅焯水去血沫\n2. 锅中放少许油，加入冰糖小火熬至融化呈棕色\n3. 放入肉块翻炒上色\n4. 加入姜片、葱段、八角\n5. 倒入料酒、生抽、老抽\n6. 加水没过肉块，大火烧开后转小火炖1小时\n7. 最后大火收汁即可'
                        };
                        recipeDetail = basicRecipes[recipeName] || `暂无${recipeName}的详细做法，请尝试使用AI搜索功能。`;
                    }
                    
                    // 生成随机图片URL（实际应用中应使用真实菜谱图片）
                    const imageUrl = `https://source.unsplash.com/300x200/?food,${encodeURIComponent(recipeName)}`;
                    
                    detailContainer.innerHTML = `
                        <div class="recipe-detail-header">
                            <button class="back-btn" onclick="document.getElementById('recipeDetail').style.display='none';document.getElementById('recipeList').style.display='block';">返回</button>
                            <h2>${recipeName}</h2>
                        </div>
                        <div class="recipe-detail-image">
                            <img src="${imageUrl}" alt="${recipeName}" onerror="this.src='https://via.placeholder.com/300x200?text=暂无图片'">
                        </div>
                        <div class="recipe-detail-content">
                            ${recipeDetail.replace(/\n/g, '<br>')}
                        </div>
                    `;
                } catch (error) {
                    detailContainer.innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
                }
            }
            
            // AI生成菜谱
            async generateAIRecipe() {
                const recipeInput = document.getElementById('aiRecipeInput');
                const recipeName = recipeInput.value.trim();
                
                if (!recipeName) {
                    alert('请输入菜名');
                    return;
                }
                
                if (!this.aiConfig.apiKey) {
                    alert('请先配置AI接口');
                    return;
                }
                
                const detailContainer = document.getElementById('recipeDetail');
                detailContainer.style.display = 'block';
                document.getElementById('recipeList').style.display = 'none';
                
                detailContainer.innerHTML = '<div class="loading">AI正在生成菜谱，请稍候...</div>';
                this.updateResponse(`🧪 正在使用AI生成${recipeName}菜谱，请稍候...`);
                
                try {
                    const systemPrompt = `请为"${recipeName}"创建一个详细的菜谱，包括：
1. 菜品简介
2. 所需食材（具体用量）
3. 详细步骤
4. 烹饪技巧和注意事项

请以HTML格式返回，使用适当的标签（h3、ul、li、ol、p等）进行格式化，以便直接插入网页中显示。`;
                    
                    const requestBody = {
                        model: this.aiConfig.model,
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            }
                        ],
                        max_tokens: 800,
                        temperature: 0.7
                    };
                    
                    const response = await fetch(`${this.aiConfig.baseUrl}/chat/completions`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.aiConfig.apiKey}`
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API请求失败: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const recipeDetail = data.choices[0].message.content.trim();
                    const imageUrl = `https://source.unsplash.com/300x200/?food,${encodeURIComponent(recipeName)}`;
                    
                    detailContainer.innerHTML = `
                        <div class="recipe-detail-header">
                            <button class="back-btn" onclick="document.getElementById('recipeDetail').style.display='none';document.getElementById('recipeList').style.display='block';">返回</button>
                            <h2>${recipeName}</h2>
                        </div>
                        <div class="recipe-detail-image">
                            <img src="${imageUrl}" alt="${recipeName}" onerror="this.src='https://via.placeholder.com/300x200?text=暂无图片'">
                        </div>
                        <div class="recipe-detail-content">
                            ${recipeDetail}
                        </div>
                    `;
                    
                    this.updateResponse(`✅ ${recipeName}菜谱已生成完成！`);
                } catch (error) {
                    console.error('生成菜谱出错:', error);
                    detailContainer.innerHTML = `<div class="error">生成失败: ${error.message}</div>`;
                    this.updateResponse(`❌ 生成菜谱失败: ${error.message}`);
                }
            }
            
            async searchRecipesWithAI(query) {
                const systemPrompt = `你是一个专业的厨师助手。用户搜索菜谱关键词："${query}"。
                
请为用户推荐3-5个相关的菜谱，每个菜谱包含：
1. 菜名
2. 简短描述（一句话）
3. 主要特点

请以JSON格式返回，格式如下：
[
  {"name": "菜名", "desc": "简短描述", "difficulty": "难度等级"},
  ...
]

只返回JSON数据，不要其他文字。`;
                
                const requestBody = {
                    model: this.aiConfig.model,
                    messages: [
                        {
                            role: 'system',
                            content: systemPrompt
                        }
                    ],
                    max_tokens: 400,
                    temperature: 0.7
                };
                
                const response = await fetch(`${this.aiConfig.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.aiConfig.apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content.trim();
                
                try {
                    // 尝试解析JSON
                    const recipes = JSON.parse(aiResponse);
                    return recipes.map(recipe => 
                        `<div class="recipe-item" onclick="showRecipe('${recipe.name}', true)">
                            <strong>${recipe.name}</strong><br>
                            <small>${recipe.desc} - ${recipe.difficulty || '中等难度'}</small>
                        </div>`
                    ).join('');
                } catch (parseError) {
                    // 如果JSON解析失败，返回文本格式
                    return `<div class="recipe-item">
                        <strong>AI推荐</strong><br>
                        <small>${aiResponse}</small>
                    </div>`;
                }
            }
            
            async getRecipeDetailsWithAI(recipeName) {
                const systemPrompt = `请提供"${recipeName}"这道菜的详细做法，包括：
1. 所需食材（具体用量）
2. 制作步骤（详细步骤）
3. 烹饪技巧和注意事项

请用简洁明了的中文回答，适合家庭制作。`;
                
                const requestBody = {
                    model: this.aiConfig.model,
                    messages: [
                        {
                            role: 'system',
                            content: systemPrompt
                        }
                    ],
                    max_tokens: 600,
                    temperature: 0.7
                };
                
                const response = await fetch(`${this.aiConfig.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.aiConfig.apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content.trim();
            }
        }
        
        // 全局变量
        let vCook;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            vCook = new VCookAssistant();
        });
        
        // 全局函数
        function toggleMainVoice() {
            vCook.toggleMainVoice();
        }
        
        function toggleTimerVoice() {
            vCook.toggleTimerVoice();
        }
        
        function backToMain() {
            vCook.returnToMain();
        }
        
        function showCategoryRecipes(category) {
            vCook.showCategoryRecipes(category);
        }
        
        function generateAIRecipe() {
            vCook.generateAIRecipe();
        }
        
        function setQuickTimer(minutes) {
            vCook.setQuickTimer(minutes);
        }
        
        function updateSliderValue() {
            const slider = document.getElementById('timerSlider');
            document.getElementById('sliderValue').textContent = slider.value;
        }
        
        function setCustomTimer() {
            const minutes = parseInt(document.getElementById('timerSlider').value);
            vCook.setQuickTimer(minutes);
        }
        
        function openRecipePage() {
            vCook.openRecipePage();
        }
        
        function openTimerPage() {
            vCook.openTimerPage();
        }
        
        function returnToMain() {
            vCook.returnToMain();
        }
        
        function toggleRecipe() {
            const recipeSearch = document.getElementById('recipeSearch');
            const isVisible = recipeSearch.style.display === 'block';
            
            // 隐藏其他面板
            document.getElementById('safetyTips').style.display = 'none';
            
            recipeSearch.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                vCook.updateResponse('📖 菜谱查询已打开，您可以搜索或浏览推荐菜谱。');
                vCook.speak('菜谱查询已打开');
            }
        }
        
        function setQuickTimer(minutes) {
            vCook.setQuickTimer(minutes);
        }
        
        function updateTimerSlider() {
            vCook.updateTimerSlider();
        }
        
        function startTimerFromSlider() {
            vCook.startTimerFromSlider();
        }
        
        function toggleSafety() {
            const safetyTips = document.getElementById('safetyTips');
            const isVisible = safetyTips.style.display === 'block';
            
            // 隐藏其他面板
            document.getElementById('recipeSearch').style.display = 'none';
            
            safetyTips.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                vCook.updateResponse('🛡️ 厨房安全提醒已显示，请注意这些重要的安全事项。');
                vCook.speak('请注意厨房安全事项');
            }
        }
        
        function toggleVoice() {
            vCook.updateResponse('🎤 语音助手已激活，点击麦克风按钮开始语音交互。');
            vCook.speak('请点击麦克风开始语音交互');
        }
        
        async function searchRecipes() {
            const query = document.getElementById('recipeInput').value.toLowerCase();
            const results = document.getElementById('recipeResults');
            
            if (query.length === 0) {
                results.innerHTML = `
                    <div class="recipe-item" onclick="showRecipe('西红柿炒蛋')">
                        <strong>西红柿炒蛋</strong><br>
                        <small>经典家常菜，简单易做</small>
                    </div>
                    <div class="recipe-item" onclick="showRecipe('红烧肉')">
                        <strong>红烧肉</strong><br>
                        <small>香甜软糯，老少皆宜</small>
                    </div>
                    <div class="recipe-item" onclick="showRecipe('宫保鸡丁')">
                        <strong>宫保鸡丁</strong><br>
                        <small>川菜经典，酸甜微辣</small>
                    </div>
                `;
                return;
            }
            
            // 如果配置了AI，使用AI搜索菜谱
            if (vCook.aiConfig.apiKey) {
                try {
                    results.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">🤖 AI正在为您搜索菜谱...</div>';
                    
                    const aiRecipes = await vCook.searchRecipesWithAI(query);
                    results.innerHTML = aiRecipes;
                } catch (error) {
                    console.error('AI菜谱搜索失败:', error);
                    // 降级到基础搜索
                    basicRecipeSearch(query, results);
                }
            } else {
                // 使用基础搜索
                basicRecipeSearch(query, results);
            }
        }
        
        function basicRecipeSearch(query, results) {
            // 简单的搜索逻辑
            const recipes = [
                { name: '西红柿炒蛋', desc: '经典家常菜，简单易做' },
                { name: '红烧肉', desc: '香甜软糯，老少皆宜' },
                { name: '宫保鸡丁', desc: '川菜经典，酸甜微辣' },
                { name: '麻婆豆腐', desc: '川菜代表，麻辣鲜香' },
                { name: '糖醋里脊', desc: '酸甜可口，老少皆宜' },
                { name: '青椒肉丝', desc: '家常小炒，营养丰富' }
            ];
            
            const filtered = recipes.filter(recipe => 
                recipe.name.includes(query) || recipe.desc.includes(query)
            );
            
            if (filtered.length === 0) {
                results.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">没有找到相关菜谱</div>';
            } else {
                results.innerHTML = filtered.map(recipe => 
                    `<div class="recipe-item" onclick="showRecipe('${recipe.name}')">
                        <strong>${recipe.name}</strong><br>
                        <small>${recipe.desc}</small>
                    </div>`
                ).join('');
            }
        }
        
        async function showRecipe(recipeName, useAI = false) {
            if (useAI && vCook.aiConfig.apiKey) {
                try {
                    vCook.updateResponse('🤖 正在为您查找详细菜谱...');
                    const aiRecipe = await vCook.getRecipeDetailsWithAI(recipeName);
                    vCook.updateResponse(`📖 ${recipeName}：\n\n${aiRecipe}`);
                    vCook.speak(`${recipeName}的详细做法已为您显示`);
                } catch (error) {
                    console.error('AI菜谱详情获取失败:', error);
                    // 降级到基础菜谱
                    showBasicRecipe(recipeName);
                }
            } else {
                showBasicRecipe(recipeName);
            }
        }
        
        function showBasicRecipe(recipeName) {
            const recipes = {
                '西红柿炒蛋': '西红柿炒蛋做法：1.鸡蛋打散加盐，热油炒熟盛起 2.西红柿切块炒出汁水 3.倒入鸡蛋翻炒，调味即可',
                '红烧肉': '红烧肉做法：1.五花肉切块焯水 2.炒糖色至焦糖色 3.下肉块炒匀 4.加调料和水，小火炖1小时 5.大火收汁',
                '宫保鸡丁': '宫保鸡丁做法：1.鸡胸肉切丁腌制 2.花生米炸熟 3.爆炒鸡丁至变色 4.下干辣椒花椒爆香 5.调味炒匀即可',
                '麻婆豆腐': '麻婆豆腐做法：1.豆腐切块焯水 2.炒肉末至酥香 3.下豆瓣酱炒红油 4.加豆腐和调料烧制 5.勾芡撒花椒面',
                '糖醋里脊': '糖醋里脊做法：1.里脊肉切条腌制 2.裹淀粉炸至金黄 3.调糖醋汁 4.炒糖醋汁至浓稠 5.倒入里脊炒匀',
                '青椒肉丝': '青椒肉丝做法：1.肉丝腌制 2.青椒切丝 3.热油炒肉丝至变色 4.下青椒丝炒断生 5.调味炒匀即可'
            };
            
            const recipe = recipes[recipeName] || '抱歉，暂时没有这道菜的详细做法。';
            vCook.updateResponse(`📖 ${recipeName}：${recipe}`);
            vCook.speak(`${recipeName}的做法已为您显示`);
        }
        
        function pauseTimer() {
            vCook.pauseTimer();
        }
        
        function resetTimer() {
            vCook.resetTimer();
        }
        
        function toggleAIConfig() {
            const panel = document.getElementById('aiConfigPanel');
            const form = document.getElementById('aiConfigForm');
            const isVisible = panel.style.display === 'block';
            
            panel.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                // 加载当前配置
                loadAIConfigToForm();
                updateAIStatus();
            }
        }
        
        function loadAIConfigToForm() {
            document.getElementById('aiProvider').value = vCook.aiConfig.provider;
            document.getElementById('aiApiKey').value = vCook.aiConfig.apiKey;
            document.getElementById('aiBaseUrl').value = vCook.aiConfig.baseUrl;
            document.getElementById('aiModel').value = vCook.aiConfig.model;
        }
        
        function saveAIConfig() {
            const provider = document.getElementById('aiProvider').value;
            const apiKey = document.getElementById('aiApiKey').value;
            const baseUrl = document.getElementById('aiBaseUrl').value;
            const model = document.getElementById('aiModel').value;
            
            // 根据提供商设置默认值
            let finalBaseUrl = baseUrl;
            let finalModel = model;
            
            if (!baseUrl) {
                switch (provider) {
                    case 'openai':
                        finalBaseUrl = 'https://api.openai.com/v1';
                        break;
                    case 'claude':
                        finalBaseUrl = 'https://api.anthropic.com';
                        break;
                    case 'gemini':
                        finalBaseUrl = 'https://generativelanguage.googleapis.com/v1';
                        break;
                    case 'local':
                        finalBaseUrl = 'http://localhost:11434/v1';
                        break;
                }
            }
            
            if (!model) {
                switch (provider) {
                    case 'openai':
                        finalModel = 'gpt-3.5-turbo';
                        break;
                    case 'claude':
                        finalModel = 'claude-3-haiku-20240307';
                        break;
                    case 'gemini':
                        finalModel = 'gemini-pro';
                        break;
                    case 'local':
                        finalModel = 'llama2';
                        break;
                }
            }
            
            vCook.aiConfig = {
                provider: provider,
                apiKey: apiKey,
                baseUrl: finalBaseUrl,
                model: finalModel
            };
            
            localStorage.setItem('vcook-ai-config', JSON.stringify(vCook.aiConfig));
            updateAIStatus();
            
            vCook.updateResponse('✅ AI配置已保存！现在可以使用智能菜谱推荐和语音理解功能。');
            vCook.speak('AI配置已保存');
        }
        
        async function testAIConnection() {
            if (!vCook.aiConfig.apiKey) {
                alert('请先输入API密钥');
                return;
            }
            
            try {
                vCook.updateResponse('🔄 正在测试AI连接...');
                const testResponse = await vCook.callAI('你好，请简单回复确认连接正常');
                vCook.updateResponse('✅ AI连接测试成功！\n\n' + testResponse);
                vCook.speak('AI连接测试成功');
                updateAIStatus();
            } catch (error) {
                vCook.updateResponse('❌ AI连接测试失败：' + error.message);
                vCook.speak('AI连接测试失败');
                console.error('AI连接测试失败:', error);
            }
        }
        
        function clearAIConfig() {
            if (confirm('确定要清除AI配置吗？这将删除所有保存的设置。')) {
                vCook.aiConfig = {
                    provider: 'openai',
                    apiKey: '',
                    baseUrl: 'https://api.openai.com/v1',
                    model: 'gpt-3.5-turbo'
                };
                localStorage.removeItem('vcook-ai-config');
                loadAIConfigToForm();
                updateAIStatus();
                vCook.updateResponse('🗑️ AI配置已清除，已切换到基础功能模式。');
                vCook.speak('AI配置已清除');
            }
        }
        
        function updateAIStatus() {
            const statusElement = document.getElementById('aiStatus');
            const formElement = document.getElementById('aiConfigForm');
            
            if (vCook.aiConfig.apiKey) {
                statusElement.className = 'ai-status connected';
                statusElement.innerHTML = `
                    <span>🟢 AI已连接 (${vCook.aiConfig.provider})</span>
                    <button class="btn btn-secondary" onclick="toggleConfigForm()">管理</button>
                `;
            } else {
                statusElement.className = 'ai-status disconnected';
                statusElement.innerHTML = `
                    <span>🔴 AI未配置</span>
                    <button class="btn btn-secondary" onclick="toggleConfigForm()">配置</button>
                `;
            }
        }
        
        function toggleConfigForm() {
            const form = document.getElementById('aiConfigForm');
            const isVisible = form.style.display === 'block';
            form.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                loadAIConfigToForm();
            }
        }
        
        // 页面加载时更新AI状态
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                updateAIStatus();
                // 默认显示AI配置面板
                document.getElementById('aiConfigPanel').style.display = 'block';
            }, 1000);
        });
    </script>
</body>
</html>